## Урок 2. Кластер Pacemaker, iSCSI, GFS2

#### Д/з:
Цель:
развернуть в Yandex Cloud следующую конфигурацию с помощью terraform
* виртуалка с iscsi
* 3 виртуальные машины с разделяемой файловой системой GFS2 поверх cLVM

Для сдачи:
* terraform манифесты
* ansible роль
* README файл

Задание повышенной сложности\*\* с fencing агентом
#### Pre-requisites
* В ~/.ssh/ должен быть ключ, тип не важен.
* ansible-core 2.14.1, ansible 7.0.0
* ansible-galaxy install OndrejHome.targetcli
* ansible-galaxy install OndrejHome.iscsiadm
#### Проблемы и их решение, в порядке возникновения
1. При создании inventory используется цикл %{ for }.
2. Создание ВМ iscsi с local_disk обрывается ошибкой PermissionDenied, поэтому вместо local_disk использован secondary_disk.
3. В именах дисковых ресурсов нельзя использовать '\_', имена должны быть уникальными.
5. Для multipath нужно 2 сетевых интерфейса. Для создания 2-го интерфейса поддержка Yandex Cloud должна активировать такую возможность.
5. Использован образ CentOS 7, т.к. в CentOS 8 переименованы некоторые команды и ресурсы.
6. Фенсинг отключен.
5. При создании кластера и ресурсов использован ключ --wait, т.к. каждый следующий шаг предполагает, что предыдущий завершён стартом ресурса.
6. В конце каждый узел кластера добавляет в файл /mnt/gfs2/hostnames своё имя, но из-за конкуренции чьё-то может быть перезаписано.
